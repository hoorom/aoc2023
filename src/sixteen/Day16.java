package sixteen;

import graph.Direction;

public class Day16 {

    static String test = """
            .|...\\....
            |.-.\\.....
            .....|-...
            ........|.
            ..........
            .........\\
            ..../.\\\\..
            .-.-/..|..
            .|....-|.\\
            ..//.|....""";

    static String input = """
            \\.........-......|...../................................-...........|.../.\\\\...\\|...................|.........
            ../..\\...............-../............\\.........-......-................././........|......................|...
            ......../..-........../................../...|.....-......................\\.....-..............|............/|
            ......-......-............................\\..\\............../................./.-.................\\.....|.\\|..
            ...-....-|....................-...-..../...................-....../...........|.............\\.....-...........
            ..\\............../..../................|...........|/......|..........-\\.........|...../....................|.
            \\...........\\.\\....../...|..........--.................|......//...../..-.....|.....-.........................
            ..................................................|...........\\.\\.................../.....................\\...
            .....-...................-............./.......................|............/...|..........................-..
            ..............-......\\..............\\................................-.|../................|....|../\\....|....
            ./../\\..............-..............|.........................|\\................................|.-./.....|....
            ..........\\....-................./........../............../........\\-..........\\....-........................
            .........-....../.............\\../-......-.............\\........\\......./......-|..\\.........\\............-...
            ......-....|.......|.............................\\..-.............\\......-......................|......|......
            ....\\......../.............................||....-.............-.........................\\........../.........
            ........-......................................................\\.........../...|./............-|..............
            ......\\..-........|./..................\\../....|.........-\\...-..-....\\...-................\\..................
            |./.....\\.-......../.-|.............\\..\\.\\......-.|............/.|..\\|....................../.................
            ................................../..-........\\.\\..|.-..|/...-...............-............\\........-..../.....
            .......|............\\../......\\...../.......................|........|...-.|...\\...-....\\......|..............
            .................-......./........../.......|/........|....-\\........../..............-................../....
            ..../...................-..\\.........|................../..|.../...............|-\\............../.............
            .............................|....../............................|..|.........../....../....-.|..||....\\......
            .....//.........\\..........\\.|...-./.......|.-..\\...\\.......\\.-.............../.....|..............-.|........
            .-...........\\.\\..........\\|..\\.....\\.|...........--.............\\.....-./.......\\................../.........
            ............\\....................................\\.......-....../.....\\....../....-.....................-.....
            \\.......\\...-.|......./\\..|...\\......|......../.....-.....|......./................./.........../.............
            /.|.....................................................\\./.........\\...|......|.......................|./..-.
            ....|............./....\\...-.\\...../.......\\.................|.............|......\\..../.../..\\...........\\...
            ..........................|...........|.../............\\..\\....\\............-|...................\\.../......\\.
            .......|\\.\\............./...../.......././..../.....-..|...\\.......|..........\\............/-.................
            .|\\....|.....-.-......\\-..........\\.....................\\...........................-...|.....|..-...........|
            /\\......|....-.............................-/....|..|........./.........................................../.-.
            ...............................|....................||....|.|....|./............./.|........./............\\...
            .......-......................./.............\\....-....-...-..\\........................................-......
            .......-....|.........../................-.....................................|............../...............
            .-..................\\.../...../\\...\\.......................\\...............-...//..\\......\\-.|..........|.....
            ..\\............................././\\............../....-..........|..\\....\\.-./...............................
            ...-.|/...........||......\\...-.........................................|.....................................
            ......|.././...........|......................./.||................\\........\\........|.|.....\\...|....|.......
            ...-......./............../.....|..-..-.|..-.......|..|....................\\...\\.......\\........|.............
            /../.................|............................/.............../....-/..|.....\\...|........................
            .........-.........|............/.......-.............-...../.\\|.......\\...-..\\.-.....|..../...........-\\..|..
            ......................................\\........|..../....|.......\\......-.................|...................
            ...\\.......|.....|....\\....................-............-....|......\\.........\\...................|...........
            .....\\.............\\...-........|.............................-|......./.........-............//.......|......
            ............/../...........-/.........................-...|...|...\\............./....-..|..........\\\\.........
            ..\\......................\\/./.........................\\..-............-\\..-...................................
            ............................\\...|.........|...|.\\.......|............/.........|.................\\............
            ............|..|...........\\..................../........|............-....-./.....\\.-..-.................../.
            ...................-.-.......-.\\............-....\\........-./.|../|.../.............\\.......\\............-....
            ..../............../........../\\...............-.............../......|.\\/.........../......|.................
            ...\\......\\.....................\\..|...............-.......................-.-|....../..................-.....
            .........\\...\\.............|........../.........................................................-...\\......-..
            ..-...........-\\.........\\....\\.............../........\\./........../....\\......../...........................
            ............|.............-.../.................|......../..-.........../............./...................\\..\\
            ........-...................................-.....\\-.........|............../..../...\\\\.|..........\\....-.....
            ..\\..\\.\\.\\.........../..|...\\............/...|......................-.........................|...............
            \\.../...../..........|.....\\...|./...|............./......\\........................-.....-.....\\..............
            |....................-..-............................../...../..............-.../...-...|../../.\\.............
            ................/......-...|....|..........\\\\......-..............|\\........|./.\\...|.......................|.
            ........../....................|./..........................|..................-.........|.........|..........
            ..../.....\\...|.......|../....................\\...\\..-...\\...\\...........|............./.-.....--.............
            .........|-..........................\\..-......--......../................\\......\\...../.|...|....../....-....
            .......|.............\\............./...............././/../..........\\.........|\\..........|..................
            ....\\........|.../......./....\\./...//.............\\..................|./.....................................
            ..........-.|\\............/..-...........\\........-....|....../........-.|.................-/.-.........|.../|
            .....-\\........\\........|.|...............................-...........\\./..........................-........\\.
            ............../........./../--|.........................-....................\\......-..\\...\\..........\\......\\
            ..|...............................\\........\\......\\..\\.....-\\............|....................................
            ..\\|.................\\-......|...............\\.........|.|...|........................|..../......-...-|...-..
            ...........................\\......................-.............................|........./......./....-......
            .........-..../........../.......|../.....-.........................../.../...........|....-./.\\..............
            .-........./..-/...........\\.......-.......-.........//.-.-......................................|...-........
            ........../.....|...........\\....../\\............-......-......../....................|......................-
            .......||....-.../....|....../....-.......|...................................................................
            .....|./........\\.-.....|..................|....\\....../......\\.......-|.....|../....\\...\\.\\........|./......-
            .-.|./............-....../............-..................|....|......-.....\\................||.\\\\.............
            ....-...-........./.........../.........\\....|.\\....|..\\.\\............................-.......//......\\..-.\\..
            ...../.........................................|..........|.-|..\\./............\\.-.../......./............-..|
            .../..........\\..............\\..../...\\.........\\................./.|....../........|............-...-.-..../.
            ..\\.\\................\\....../....................|......../\\|...../...\\....-..../...\\.....|..../...\\..........
            ......\\..-.\\........................-.....................-............|.|.............-...-..................
            ................\\...\\...../../....../.../................/.........\\.\\.................|......................
            ......................|..................-./.........\\..\\.......-..........|..\\.......\\...-...|...............
            ..........-.........................-................................./......../.....-.|......................
            .......-\\............./...............-............|.....................-..\\.................-......\\....-...
            ..........................................\\......./......\\........-|..|.....\\........\\......./................
            ........//...........-........../......./..............|...../..-..................../...\\......-..........-..
            ./....|..-|...|......-.............\\.|.........................\\...............-\\.............................
            |....................|....................../............................../...........\\...|...-..............
            \\......./....|.../.|....................|..............|..................|................\\..................
            .........|......\\.............../....\\...................................|.\\........./..-.................|./.
            ......../..................\\..................../.........................||./.-.............../..............
            ......................./.........|.|........-../........./.....|............./......|......-....|...../.......
            ................|......./............\\...-......../..................\\..\\..../.......\\.../.........-/.........
            .........-.....\\......-.....................-..-.........//...........................|...\\-............../...
            .....|............-...../.\\......................|........|...........\\..........|./......./.\\.........\\../...
            ..\\..........-.../.......|......./.................../............\\............|......../....|................
            .....\\....................-...........-......//...........\\....|..\\...-.....................\\.............../.
            ..-.....|......\\.......|.../......................\\...|...\\..\\.....|...........................\\..........|...
            ....-....-...|.\\-...-..\\............../......-./...........\\/............\\-..|.........................\\......
            ......./.....-|.|.......|....\\|||......\\.............................................\\......-.................
            .................-\\................/.-...............|............|...|.-......-..............................
            ...|.............|...............|.......-.................-.........|.../..................................|.
            ..-.../.....-.........................-....|......|/...../....\\.............................-...............-.
            .|.........-../....................../............|................\\.....|........\\...........................
            .\\\\............\\................-../.../....\\.................................|.-.....|.....\\.........-.....|.
            .............../..................../..\\.............-..\\.......\\...\\..../..-........-..../-.....|............
            \\.................................-..............|...\\./......../...........................|.........|.......""";

    public static void main(String[] args) {
//        char[][] array = toArray(test);
                char[][] array = toArray(input);

        int max = 0;
        Beam.reset();
        //        new Beam(0, 3, Direction.BOT, array);
        //
        //        while (!Beam.beamToProcess.isEmpty()) {
        //            Beam beam = Beam.beamToProcess.iterator().next();
        //            Beam.beamToProcess.remove(beam);
        //            beam.move(array);
        //        }
        //        if(Beam.energizedTile.size() > max) {
        //            max = Beam.energizedTile.size();
        //            System.out.println(max);
        //            System.out.println(Beam.createCharArray(array.length, array[0].length, Beam.energizedTile));
        //        }

        for (int i = 0; i < array[0].length; i++) {
            for (int j = 0; j < array.length; j++) {
                Beam.reset();
                if((i == 0 || j == 0) || i == array[0].length - 1 || j == array.length - 1) {
                    if(i == 0 && j == 0) {
                        max = processGetValAndReset(i, j, Direction.BOT, array, max);
                        max = processGetValAndReset(i, j, Direction.RIGHT, array, max);
                    } else if (i == array[0].length - 1 && j == array.length - 1) {
                        max = processGetValAndReset(i, j, Direction.TOP, array, max);
                        max = processGetValAndReset(i, j, Direction.LEFT, array, max);
                    } else if (i == 0 && j == array.length - 1) {
                        max = processGetValAndReset(i, j, Direction.BOT, array, max);
                        max = processGetValAndReset(i, j, Direction.LEFT, array, max);
                    } else if (i == array[0].length - 1 && j == 0) {
                        max = processGetValAndReset(i, j, Direction.TOP, array, max);
                        max = processGetValAndReset(i, j, Direction.RIGHT, array, max);
                    } else if(i == 0) {
                        max = processGetValAndReset(i, j, Direction.BOT, array, max);
                    } else if (j == 0) {
                        max = processGetValAndReset(i, j, Direction.RIGHT, array, max);
                    } else if (i == array[0].length - 1) {
                        max = processGetValAndReset(i, j, Direction.TOP, array, max);
                    } else if (j == array.length - 1) {
                         max = processGetValAndReset(i, j, Direction.LEFT, array, max);
                    }
                }
            }
        }

        System.out.println(max);

        //        System.out.println((System.currentTimeMillis() - l) * 10_000 );
        //        System.out.println(max);
        //        System.out.println(Beam.fieldToString(array));
        //        System.out.println(Beam.createCharArray(array.length, array[0].length, Beam.energizedTile));
    }

    private static int processGetValAndReset(int i, int j, Direction direction,char[][] array, int max) {
        new Beam(i, j, direction, array);
        int value = process(array);
        Beam.reset();
        return Math.max(max, value);
//        if(value > max) {
//            max = Beam.energizedTile.size();
//            System.out.println(i + " / " + j + " : " + max);
//            System.out.println(Beam.createCharArray(array.length, array[0].length, Beam.energizedTile));
//        }
    }

    private static int process(char[][] array) {
        while (!Beam.beamToProcess.isEmpty()) {
            Beam beam = Beam.beamToProcess.iterator().next();
            Beam.beamToProcess.remove(beam);
            beam.move(array);
        }
        return Beam.energizedTile.size();
    }

    public static char[][] toArray(String input) {
        String[] lines = input.split("\n");

        // Maintenant, pour chaque ligne, divisez-la en caract√®res
        char[][] array = new char[lines.length][];
        for (int i = 0; i < lines.length; i++) {
            array[i] = lines[i].toCharArray();
        }
        return array;
    }
}
